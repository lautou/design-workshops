**CRITICAL INSTRUCTION FOR FUTURE EDITS:** As an AI assistant editing this file, you MUST operate with extreme care. Your primary directive is to **avoid regressions**. Do not remove, simplify, or rephrase existing rules and instructions unless explicitly told to do so. Past versions of this prompt have been refined to handle specific edge cases, and removing details can break the downstream pipeline. Always assume the existing instructions are there for a critical reason.

---

# **Gemini project to generate google slide from json for Red Hat design workshops**

This is a project that automatically generates a Google Slide presentation from a JSON file. The JSON file is generated by Gemini from a prompt that is also generated automatically.

## **High level description of the project**

The project is composed of two main parts:

1. A **prompt generator** that creates individual, context-rich prompt files for each workshop.
2. A **slide generator** that takes the AI-generated JSON and builds a Google Slides presentation.

The project is designed to be used by Red Hat consultants to generate presentations for design workshops. The presentation is based on a template, and the content is generated by Gemini from source documentation.

The project is composed of the following files:

- run.sh: A unified wrapper script to run all commands of the project.
- generate_prompt.py: The main script that generates the individual prompt files. It intelligently creates a two-step prompt process for workshops that have too many source files for a single upload.
- build_slides_from_json.py: The script that generates the Google Slide presentation from the JSON file.
- extract_images.py: A script that extracts images referenced in the JSON file.
- create_s3_bucket.py: A script to automatically create and configure the AWS S3 bucket for image hosting.
- workshops.yaml: A YAML file that describes the workshops, including optional ODF source files and flags for the consolidation workflow.
- layouts.yaml: A YAML file that describes the layout of the presentation.
- gemini-prompt-generate-json.md: The master template for the prompt to generate the JSON file.
- gemini-prompt-consolidate-sources.md: The template for the prompt used to consolidate multiple source files into a single document.
- gemini-prompt-generate-workshop-docs-list.md: The prompt used to automatically populate workshops.yaml.
- gemini-prompt-generate-workshop-decks.md: This file.

## **The run.sh script, the entrypoint of the project**

This script is the single wrapper for all commands of the project. The available commands are:

- generate-prompt: Builds the necessary prompt file(s) for each enabled workshop in the generated_prompts/ directory.
- download-docs: Downloads all source PDFs from the config.
- extract-images: Extracts image references from all generated JSON files in the json_source/ directory.
- build-slides: Builds a Google Slides presentation for every JSON file in the json_source/ directory.

## **The build_slides_from_json.py script**

This is the core script that constructs the Google Slides presentation. It is a complex piece of software with several key responsibilities:

- **Authentication**: It handles a robust, token-based OAuth 2.0 authentication flow with Google APIs (Slides and Drive) using a credentials.json file. It also authenticates with AWS S3 using credentials from the .env file.
- **Presentation Creation**: It starts by making a copy of a master Google Slides template (defined in .env) into a specified Google Drive folder. It then removes all existing slides from the copy to prepare a clean canvas.
- **Theme and Layout Discovery**: The script fetches information about the presentation's themes and layouts. It specifically targets a theme by its display name (e.g., "Red Hat \- Light") to ensure the correct slide masters are used.
- **Slide Generation**: It iterates through the slides array in the input JSON file. For each JSON object, it creates a new slide in the presentation, applying the correct layout based on the mapping defined in layouts.yaml.
- **Content Population**:
  - **Text**: It populates text into slide placeholders (Title, Subtitle, Body, etc.). It includes a sophisticated function (get_rich_text_requests) that parses markdown-like syntax (\*\*bold\*\*, \- bullet points) from the JSON body field and converts it into a series of Google Slides API requests for formatting, including indentation levels for nested bullets.
  - **Speaker Notes**: It adds the content of the speakerNotes field to the notes section of each slide.
  - **Global Content**: It replaces placeholder text on the master slide to apply global headers and footers across the presentation.
- **Image Handling**:
  - When a slide includes an imageReference, the script finds the corresponding locally extracted image.
  - It uploads this image to the configured AWS S3 bucket, making it publicly readable.
  - It intelligently calculates the optimal size and position for the image based on the slide layout (image_fullscreen vs. image_right) and the other placeholders on the slide, ensuring the image fits neatly within the available content area without overlapping titles or footers.
- **Table Handling**:
  - For table_fullscreen layouts, it creates a table with the specified headers and rows.
  - **Auto-Fitting Algorithm**: Crucially, it includes an advanced function (fit_table_to_area) to handle tables that are too large for the slide. After creating a table, it checks its rendered height. If the height exceeds the available space, it iteratively calculates and applies a smaller font size to the entire table until it fits within the content area, preventing text from overflowing.
- **API Efficiency**: It makes extensive use of the Google Slides API's batchUpdate functionality to perform multiple operations (e.g., creating a slide, inserting text, formatting text) in a single API call, which is significantly more efficient than making individual requests.
