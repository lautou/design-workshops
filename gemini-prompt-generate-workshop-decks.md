# **Gemini project to generate google slide from json for Red Hat design workshops**

This is a project that automatically generates a Google Slide presentation from a JSON file.
The JSON file is generated by Gemini from a prompt that is also generated automatically.

## **High level description of the project**

The project is composed of two main parts:

1.  A prompt generator that will generate a prompt for Gemini to generate a JSON file.
2.  A slide generator that will generate a Google Slide presentation from the JSON file.

The project is designed to be used by Red Hat consultants to generate a presentation for a design workshop.
The presentation is based on a template that is defined in a YAML file.
The content of the presentation is generated by Gemini from a prompt that is also generated automatically.
The project is composed of the following files:

- `run.sh`: a wrapper script to run the different commands of the project.
- `run_pipeline.py`: the main script that generates the prompt for Gemini.
- `run_build.sh`: a wrapper script to run the build commands of the project.
- `build_slides_from_json.py`: the script that generates the Google Slide presentation from the JSON file.
- `extract_images.py`: a script that extracts the images url from the JSON file and upload them to a S3 bucket.
- `workshops.yaml`: a YAML file that describes the workshop to generate.
- `layouts.yaml`: a YAML file that describes the layout of the presentation.
- `gemini-prompt-generate-json.md`: a markdown file that contains the template of the prompt to generate the JSON file.
- `gemini-prompt-generate-workshop-decks.md`: this file.
- `create_s3_bucket.py`: a script to automatically create and configure the AWS S3 bucket for image hosting.

## **The `run.sh` script, the entrypoint of the project**

This script is a wrapper to the different commands of the project.
The available commands are:

- `generate-prompt`: generate the prompt for Gemini to generate the JSON file.
- `download-docs`: downloads all required source PDFs from product documentation sites.

The user must provide the workshop name as an argument.
The workshop name must be defined in the `workshops.yaml` file.
Example:

`./run.sh generate-prompt`

This command will generate the prompt and save it to `generated-prompt.md`.
The user can then copy the prompt and paste it to Gemini to generate the JSON file.
When the user has generated the JSON file, he must save it in the `json_source` directory with the name `result.json`.

Then the user can run the build commands to generate the presentation.

## **The `run_build.sh` script, the build part of the project**

This script is a wrapper to the build commands of the project.
The available commands are:

- `extract`: extract the images url from the JSON file and save them locally.
- `build`: generate the Google Slide presentation from the JSON file, uploading images to S3.

To run the build commands, the user must have the environment variables set in the `.env` file.

The user must also have the `credentials.json` file in the root directory of the project.
This file contains the credentials to access the Google Slides API.
The user must also have the `token.json` file in the root directory of the project.
This file contains the token to access the Google Slides API, which is generated on the first run of the `build` command.

Then the user can run the build commands.
Example:
`./run_build.sh extract`
`./run_build.sh build`

This will extract the images from the JSON file, upload them to the S3 bucket and generate the presentation.

## **The `build_slides_from_json.py` script**

This is the core script that constructs the Google Slides presentation. It is a complex piece of software with several key responsibilities:

- **Authentication**: It handles a robust, token-based OAuth 2.0 authentication flow with Google APIs (`Slides` and `Drive`) using a `credentials.json` file. It also authenticates with AWS S3 using credentials from the `.env` file.
- **Presentation Creation**: It starts by making a copy of a master Google Slides template (defined in `.env`) into a specified Google Drive folder. It then removes all existing slides from the copy to prepare a clean canvas.
- **Theme and Layout Discovery**: The script fetches information about the presentation's themes and layouts. It specifically targets a theme by its display name (e.g., "Red Hat - Light") to ensure the correct slide masters are used.
- **Slide Generation**: It iterates through the `slides` array in the input JSON file. For each JSON object, it creates a new slide in the presentation, applying the correct layout based on the mapping defined in `layouts.yaml`.
- **Content Population**:
  - **Text**: It populates text into slide placeholders (Title, Subtitle, Body, etc.). It includes a sophisticated function (`get_rich_text_requests`) that parses markdown-like syntax (`**bold**`, `- bullet points`) from the JSON `body` field and converts it into a series of Google Slides API requests for formatting, including indentation levels for nested bullets.
  - **Speaker Notes**: It adds the content of the `speakerNotes` field to the notes section of each slide.
  - **Global Content**: It replaces placeholder text on the master slide to apply global headers and footers across the presentation.
- **Image Handling**:
  - When a slide includes an `imageReference`, the script finds the corresponding locally extracted image.
  - It uploads this image to the configured AWS S3 bucket, making it publicly readable.
  - It intelligently calculates the optimal size and position for the image based on the slide layout (`image_fullscreen` vs. `image_right`) and the other placeholders on the slide, ensuring the image fits neatly within the available content area without overlapping titles or footers.
- **Table Handling**:
  - For `table_fullscreen` layouts, it creates a table with the specified headers and rows.
  - **Auto-Fitting Algorithm**: Crucially, it includes an advanced function (`fit_table_to_area`) to handle tables that are too large for the slide. After creating a table, it checks its rendered height. If the height exceeds the available space, it iteratively calculates and applies a smaller font size to the entire table until it fits within the content area, preventing text from overflowing.
- **API Efficiency**: It makes extensive use of the Google Slides API's `batchUpdate` functionality to perform multiple operations (e.g., creating a slide, inserting text, formatting text) in a single API call, which is significantly more efficient than making individual requests.
